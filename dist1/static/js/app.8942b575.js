(function(){"use strict";var e={917:function(e,t,o){var r=o(538),i=function(){var e=this,t=e._self._c;return t("div",{staticClass:"app"},[t("router-view")],1)},a=[],n={name:"app"},s=n,c=o(1001),d=(0,c.Z)(s,i,a,!1,null,"559d8a16",null),l=d.exports,u=o(8345),m=function(){var e=this,t=e._self._c;return t("div",{staticClass:"app"},[t("el-container",[t("el-aside",{staticClass:"el-aside",attrs:{width:"260px"}},[t("Aside")],1),t("el-container",[t("el-main",[t("Record")],1)],1)],1)],1)},h=[],p=function(){var e=this,t=e._self._c;return t("div",[t("h2",[e._v("Options")]),t("div",{staticClass:"setDevicesWrapper"},[t("div",{staticClass:"setDevices"},[t("label",{staticClass:"label"},[e._v("audio Source")]),t("select",{ref:"audioSource",attrs:{id:"audioSource"},on:{change:e.getAudioSource}},e._l(e.audioSourceOption,(function(o,r){return t("option",{key:r,domProps:{value:o.value}},[e._v(e._s(o.text))])})),0)]),t("div",{staticClass:"setDevices"},[t("label",{staticClass:"label"},[e._v("audio output device")]),t("select",{ref:"audioOutput",attrs:{id:"audioOutput"},on:{change:e.getAudiooutput}},e._l(e.audioOutputOption,(function(o,r){return t("option",{key:r,domProps:{value:o.value}},[e._v(e._s(o.text))])})),0)]),t("div",{staticClass:"setDevices"},[t("label",{staticClass:"label"},[e._v("video Source")]),t("select",{ref:"videoSource",attrs:{id:"videoSource"},on:{change:e.getCamera}},e._l(e.videoSourceOption,(function(o,r){return t("option",{key:r,domProps:{value:o.value}},[e._v(e._s(o.text))])})),0)]),t("div",{directives:[{name:"show",rawName:"v-show",value:"advanced-Recorded"===e.currentRecordMethod,expression:"currentRecordMethod === 'advanced-Recorded' "}],staticClass:"setMute"},[t("label",{staticClass:"label"},[e._v("isMute")]),t("select",{ref:"isMute",attrs:{id:"isMute"},on:{change:e.isSetMute}},e._l(e.muteData,(function(o,r){return t("option",{key:r,domProps:{value:o.value}},[e._v(e._s(o.value))])})),0)]),t("div",{staticClass:"recordMethod"},[t("label",{staticClass:"label"},[e._v("record method")]),t("select",{ref:"recordMethod",staticClass:"recording-media",on:{change:e.getRecordMethod}},e._l(e.recordMethodOption,(function(o,r){return t("option",{key:r,domProps:{value:o.value}},[e._v(e._s(o.text))])})),0)])])])},v=[],f={name:"Aside",data(){return{audioSourceOption:[],audioOutputOption:[],videoSourceOption:[],recordMethodOption:[{index:0,text:"normal-Recorded",value:"normal-Recorded"},{index:1,text:"advanced-Recorded",value:"advanced-Recorded"}],currentAudioSource:"",currentAudioutput:"",currentVideoSource:"",currentRecordMethod:"",muteData:[{index:0,value:"否"},{index:1,value:"是"}],isMute:""}},async created(){await this.getDevices()},mounted(){this.audioSource=this.$refs.audioSource,this.audiooutput=this.$refs.audioOutput,this.videoSource=this.$refs.videoSource,this.isMuteElement=this.$refs.isMute,this.recordMethod=this.$refs.recordMethod,this.currentRecordMethod=this.recordMethodOption[0].value,this.$store.commit({type:"setCurrentRecordMethod",content:this.currentRecordMethod})},methods:{handleOpen(e,t){console.log(e,t)},handleClose(e,t){console.log(e,t)},async getDevices(){let e=this;navigator.mediaDevices&&navigator.mediaDevices.enumerateDevices?navigator.mediaDevices.enumerateDevices().then(e.showDevice).catch((e=>{console.log(e.name+":"+e.message)})):console.log("不支持获取设备信息！")},showDevice(e){const t=this;e.forEach((function(e){var o={text:e.label||e.deviceId,value:e.deviceId};console.log(e),"default"!==e.deviceId&&"communications"!==e.deviceId&&("audioinput"===e.kind?t.audioSourceOption.push(o):"audiooutput"===e.kind?t.audioOutputOption.push(o):"videoinput"===e.kind&&t.videoSourceOption.push(o))})),console.warn("This.audioSourceOption:",t.audioSourceOption),t.audioSourceOption.length&&t.audioSourceOption[0].value&&(t.currentAudioSource=t.audioSourceOption[0].value,t.$store.commit({type:"setCurrentAudioSource",content:t.currentAudioSource})),t.audioOutputOption.length&&t.audioOutputOption[0].value&&(t.currentAudioutput=t.audioOutputOption[0].value,t.$store.commit({type:"setCurrentAudioOutput",content:t.currentAudioutput})),t.videoSourceOption.length&&t.videoSourceOption[0].value&&(t.currentVideoSource=t.videoSourceOption[0].value,t.$store.commit({type:"setCurrentVideoSource",content:t.currentVideoSource})),t.$store.commit({type:"setMuteState",content:"是"===t.isMuteElement.value}),console.warn("This.$store:",t.$store)},getAudioSource(){this.currentAudioSource=this.audioSource.value,this.$store.dispatch("modifyAudioSource",{content:this.currentAudioSource})},getAudiooutput(){this.currentAudioutput=this.audiooutput.value,this.$store.dispatch("modifyAudioOutput",{content:this.currentAudioutput})},getCamera(){this.currentVideoSource=this.videoSource.value,this.$store.dispatch("modifyVideoSource",{content:this.currentVideoSource})},getRecordMethod(){this.currentRecordMethod=this.recordMethod.value,this.$store.dispatch("modifyRecordMethod",{content:this.currentRecordMethod})},attachSinkId(e,t){"undefined"!==typeof e.sinkId?e.setSinkId(t).then((()=>{console.log(`Success, audio output device attached: ${t}`)})).catch((e=>{let t=e;"SecurityError"===e.name&&(t=`You need to use HTTPS for selecting audio output device: ${e}`),console.error(t),audioOutputSelect.selectedIndex=0})):console.warn("Browser does not support output device selection.")},async getUserMediaOfAudio(){console.log("Requesting audio stream");let e={audio:{exact:{deviceId:this.currentAudioSource},noiseSuppression:!0,echoCancellation:!0}};if("mediaDevices"in navigator)try{const t=await navigator.mediaDevices.getUserMedia(e);let o="是"===this.isMuteElement.value;this.streamMuteSwitch({stream:t,type:"audio",mute:o}),this.$store.commit({type:"setAudioStream",content:t}),console.log("Received local audio stream")}catch(t){console.log(`getUserMedia error: ${t}`)}},isSetMute(){let e="是"===this.isMuteElement.value;this.$store.dispatch("modifyMuteState",{content:e})},streamMuteSwitch(e){if(e&&e.stream&&"audio"===e.type&&e.stream.getAudioTracks().length>0)for(let t=0;t<e.stream.getAudioTracks().length;t++)console.warn("data.mute:",e.mute),e.mute?!0===e.stream.getAudioTracks()[t].enabled&&(console.info("MuteStream exec mute audio"),e.stream.getAudioTracks()[t].enabled=!1,this.isMute=!0):!1===e.stream.getAudioTracks()[t].enabled&&(console.info("MuteStream exec unmute audio"),e.stream.getAudioTracks()[t].enabled=!0,this.isMute=!1)}}},g=f,S=(0,c.Z)(g,p,v,!1,null,"3fcdde99",null),y=S.exports,w=function(){var e=this,t=e._self._c;return t("div",{staticClass:"record"},["normal-Recorded"===e.currentRecordMethod?t("div",{staticClass:"recordWrapper"},[t("NormalRecord",{attrs:{normalRecordingMedia:e.normalRecordingMedia}})],1):e._e(),"advanced-Recorded"===e.currentRecordMethod?t("div",[t("AdvanceRecord",{attrs:{advancedRecordingMedia:e.advancedRecordingMedia}})],1):e._e()])},M=[],b=function(){var e=this,t=e._self._c;return t("div",{staticClass:"advanceRecord"},[t("div",{staticClass:"recordBttonWrapper"},[t("div",{staticClass:"recordBtton"},[t("select",{ref:"advancedRecordMedia",staticClass:"recording-media",on:{change:e.getAdavncedRecordMedia}},e._l(e.advancedRecordingMedia,(function(o,r){return t("option",{key:r,domProps:{value:o.value}},[e._v(e._s(o.text))])})),0),t("div",{directives:[{name:"show",rawName:"v-show",value:"record-regionalScreen"===e.currentRecordType,expression:"currentRecordType === 'record-regionalScreen' "}],ref:"shareScreenBtn",staticClass:"recordBtn"},[t("button",{ref:"shareScreenBtn",on:{click:e.handleShareStream}},[e._v("开启共享")])]),t("div",{staticClass:"recordBtn"},[t("button",{ref:"startBtn",staticClass:"startBtn",on:{click:e.handleRecord}},[e._v("Start Recording")])])])]),t("div",{staticClass:"recordContent"},["record-camera-plus-screen"===e.currentRecordType?t("div",[t("MutiStream")],1):e._e(),"record-regionalScreen"===e.currentRecordType?t("div",[t("RegionalStream")],1):e._e(),"gif-record"===e.currentRecordType?t("div",[t("GifRecord")],1):e._e(),"microphone-mp3"===e.currentRecordType?t("div",[t("MicrophoneMp3")],1):e._e()])])},R=[],x=function(){var e=this,t=e._self._c;return t("div",{staticClass:"recordMutistream"},[t("div",{staticClass:"recordContainer"},[t("div",{ref:"downLoadBtn",staticClass:"downLoadBtn",staticStyle:{"text-align":"center",display:"none"}},[t("button",{staticClass:"save-to-disk",on:{click:e.downLoad}},[e._v("Save To Disk")]),t("button",{staticClass:"open-new-tab",on:{click:e.startNewTab}},[e._v("Open New Tab")])]),t("div",{staticClass:"mutistreamContent"},[t("video",{ref:"mutistreamVideo",staticClass:"mutistreamVideo",staticStyle:{transform:"scale(1)"},attrs:{width:"640"}})])])])},C=[];o(1703);let k=function(e){var t=e.getFullYear(),o=e.getMonth()+1,r=e.getDate(),i=e.getHours(),a=e.getMinutes(),n=e.getSeconds(),s=e.getMilliseconds(),c=o<10?"0"+o:o,d=r<10?"0"+r:r,l=i<10?"0"+i:i,u=a<10?"0"+a:a,m=n<10?"0"+n:n,h=s<10?"00"+s:s<100?"0"+s:s;return"".concat(t).concat("-").concat(c).concat("-").concat(d).concat("@").concat(l).concat(":").concat(u).concat(":").concat(m).concat(".").concat(h)};var T=k,A=o(5212),D=o.n(A);const $=new r["default"]({data(){return{data:{}}},created(){this.$on("getData",(e=>{this.data=e.data}))}});var O={name:"RecorsMutistream",data(){return{isMute:""}},mounted(){if(this.video=this.$refs.mutistreamVideo,this.isMute=this.$store.getters.getMuteState,console.warn("this.video:",this.video),!navigator.getDisplayMedia&&!navigator.mediaDevices.getDisplayMedia){let e="Your browser does NOT supports getDisplayMedia API.";throw new Error(e)}this.$nextTick((()=>{console.warn("nextTick nextTick nextTick nextTick"),$.$on("startRecording",(e=>{console.warn("data:",e),this.button=e.element,this.button.value=e.value,this.startRecording()})),$.$on("isMute",(e=>{console.warn("data:",e),this.isMute=e.value,this.camera&&this.streamMuteSwitch({stream:this.camera,type:"audio",mute:this.isMute})}))}))},methods:{startRecording(){let e=this;if("Stop Recording"===e.button.value)return e.button.disabled=!0,e.button.disableStateWaiting=!0,setTimeout((function(){e.button.disabled=!1,e.button.disableStateWaiting=!1}),2e3),void e.recorder.stopRecording(e.stopRecordingCallback);e.$refs.downLoadBtn.style.display="none",e.captureScreen((function(t){e.screen=t,e.keepStreamActive(t),e.captureCamera((function(o){e.camera=o,e.isMute&&e.streamMuteSwitch({stream:e.camera,type:"audio",mute:e.isMute}),e.keepStreamActive(o),t.width=window.screen.width,t.height=window.screen.height,t.fullcanvas=!0,console.warn("screen.width :",t.width+"  * "+t.height),o.width=320,o.height=240,o.top=t.height-o.height,o.left=t.width-o.width,e.button.value="Stop Recording",$.$emit("startRecordingValue",{isRecording:!1,value:"Stop Recording"}),e.recorder=D()([t,o],{type:"video",mimeType:"video/webm",previewStream:function(t){console.warn("s:",t),window.stream=t,e.video.muted=!0,e.video.srcObject=t,e.video.play()}}),e.recorder.startRecording()}),(function(e){console.error(e),alert("get camera failed.\n"+e)}))}))},captureScreen(e){console.warn("callback:",e);let t=this;t.invokeGetDisplayMedia((function(o){t.addStreamStopListener(o,(function(){(t.screen||t.camera)&&t.recorder.stopRecording(t.stopRecordingCallback)})),e(o)}),(function(e){console.error(e),alert("Unable to capture your screen. Please check console logs.\n"+e)}))},captureCamera(e){let t={audio:{exact:this.$store.getters.getCurrentAudioSource},video:{exact:{deviceId:this.$store.getters.getCurrentVideoSource},noiseSuppression:!0,echoCancellation:!0}};console.warn("mutiStream constraints:",t),navigator.mediaDevices.getUserMedia(t).then(e)},invokeGetDisplayMedia(e,t){var o={video:{displaySurface:"monitor",logicalSurface:!0,cursor:"always"}};o={audio:!0,video:!0},navigator.mediaDevices.getDisplayMedia?navigator.mediaDevices.getDisplayMedia(o).then(e).catch(t):navigator.getDisplayMedia(o).then(e).catch(t)},addStreamStopListener(e,t){e.addEventListener("ended",(function(){t(),t=function(){}}),!1),e.addEventListener("inactive",(function(){t(),t=function(){}}),!1),e.getTracks().forEach((function(e){e.addEventListener("ended",(function(){t(),t=function(){}}),!1),e.addEventListener("inactive",(function(){t(),t=function(){}}),!1)}))},keepStreamActive(e){var t=document.createElement("video");t.muted=!0,t.srcObject=e,t.style.display="none",t.style.zIndex="1",(document.body||document.documentElement).appendChild(t)},stopRecordingCallback(){let e=this;e.file=e.recorder.getBlob(),e.video.srcObject=null,e.url=URL.createObjectURL(e.file),e.video.src=e.url,e.video.muted=!1,e.video.play(),e.video.controls=!0,e.recorder.destroy(),e.recorder=null,e.button.value="Start Recording",$.$emit("startRecordingValue",{isRecording:!0,value:"Start Recording"}),e.$refs.downLoadBtn.style.display="block";let t=[e.screen,e.camera];t.forEach((function(e){e.getTracks().forEach((function(e){e.stop()}))})),e.screen=e.camera=null},downLoad(){let e;e={type:"video/webm"};let t=new Date(parseInt((new Date).getTime()));t=T(t);let o=document.createElement("a");o.target="_blank",o.style.display="none",o.href=this.url,o.download="record- "+t+".mp4",document.body.appendChild(o),o.click()},startNewTab(){let e=new Date(parseInt((new Date).getTime()));e=T(e);let t="recorder_"+e+".webm",o=new File([this.file],t,{type:"video/webm"});window.open(URL.createObjectURL(o))},streamMuteSwitch(e){if(e&&e.stream&&"audio"===e.type&&e.stream.getAudioTracks().length>0)for(let t=0;t<e.stream.getAudioTracks().length;t++)console.warn("data.mute:",e.mute),e.mute?!0===e.stream.getAudioTracks()[t].enabled&&(console.info("MuteStream exec mute audio"),e.stream.getAudioTracks()[t].enabled=!1,this.isMute=!0):!1===e.stream.getAudioTracks()[t].enabled&&(console.info("MuteStream exec unmute audio"),e.stream.getAudioTracks()[t].enabled=!0,this.isMute=!1)}},beforeDestroy(){$.$off("startRecording"),$.$off("isMute")}},L=O,B=(0,c.Z)(L,x,C,!1,null,"5d34fa4a",null),_=B.exports,E=function(){var e=this,t=e._self._c;return t("div",{staticClass:"main"},[t("div",{staticClass:"videoContent"},[t("div",{ref:"shareScreen",staticClass:"screenContrainter"},[t("div",{ref:"shareLocalVideo",staticClass:"shareScreenContent"},[t("video",{ref:"showScreenLocalVideo",staticClass:"shareScreenVideo",staticStyle:{transform:"scale(1)"},attrs:{width:"1920",height:"1080"},on:{mousedown:e.handleMouseMove,mouseup:e.handleMouseUP}})])]),t("div",{ref:"canvasWrapper",staticClass:"screenContrainter2"},[t("div",{staticClass:"shareScreenContentWrapper"},[t("div",{staticClass:"shareScreenContent2"},[t("canvas",{ref:"showScreenCanvas",staticClass:"shareScreenCanvas",staticStyle:{transform:"scale(1)"},attrs:{width:"1920",height:"1080"}})])])]),t("div",{ref:"recordWrapper",staticClass:"screenContrainter3"},[t("div",{staticClass:"shareScreenContentWrapper2"},[t("div",{ref:"downLoadBtn",staticClass:"recordBtn",staticStyle:{"text-align":"center",display:"none"}},[t("button",{on:{click:function(t){return e.download()}}},[e._v("下载视频")]),t("button",{on:{click:function(t){return e.openNewTab()}}},[e._v("open new tab")])]),t("div",{staticClass:"shareScreenContentWrapper3"},[t("video",{ref:"shareScreenRecord",staticClass:"shareScreenRecord",staticStyle:{transform:"scale(1)"},attrs:{width:"1920",height:"1080"}})])])])])])},V=[],I={name:"MainView",data(){return{timer:"",isOpenShareScreen:!1,shareScreenStream:null}},created(){if(!navigator.getDisplayMedia&&!navigator.mediaDevices.getDisplayMedia){const e="Your browser does NOT support the getDisplayMedia API.";throw new Error(e)}},mounted(){if(!navigator.getDisplayMedia&&!navigator.mediaDevices.getDisplayMedia){let e="Your browser does NOT supports getDisplayMedia API.";throw new Error(e)}this.localVideo=this.$refs.showScreenLocalVideo,this.canvas=this.$refs.showScreenCanvas,this.canvasWrapper=this.$refs.canvasWrapper,this.recordWrapper=this.$refs.recordWrapper,this.recordWrapper.style.display="none",this.ctx=this.canvas.getContext("2d"),this.recordVideo=this.$refs.shareScreenRecord,this.isMute=this.$store.getters.getMuteState,this.$nextTick((()=>{$.$on("shareScreen",(e=>{this.shareScreenBtn=e.element,this.shareScreenBtn.value=e.value,this.getDisplayMedia()})),$.$on("isMute",(e=>{this.isMute=e.value,this.audioStream&&this.streamMuteSwitch({stream:this.audioStream,type:"audio",mute:this.isMute})}))})),$.$on("startRecordingScreen",(e=>{this.recordingBtn=e.element,this.recordingBtn.value=e.value,this.startRecording()}))},methods:{async getAudioStream(){console.log("Requesting audio stream");let e={audio:{exact:{deviceId:this.$store.getters.getCurrentAudioSource},noiseSuppression:!0,echoCancellation:!0}};if("mediaDevices"in navigator)try{const t=await navigator.mediaDevices.getUserMedia(e);this.audioStream=t,this.isMute&&this.streamMuteSwitch({stream:this.audioStream,type:"audio",mute:this.isMute}),console.log("Received local audio stream")}catch(t){console.log(`getUserMedia error: ${t}`),alert(t)}},getDisplayMedia(){let e=this,t=e.localVideo,o=e.canvas;t.src=t.srcObject=null;let r={audio:!0,video:{width:{max:1920},height:{max:1080},frameRate:{max:15}}};navigator.mediaDevices.getDisplayMedia?navigator.mediaDevices.getDisplayMedia(r).then((function(r){console.warn("get stream success"),e.getAudioStream(),e.isOpenShareScreen=!0,e.shareScreenStream=r,e.localVideo.srcObject=r,t.oncanplay=function(){t.play(),t.muted=!0,t.style.width=t.videoWidth/3+"px",t.style.height=t.videoHeight/3+"px",o.style.width=t.videoWidth/3+"px",o.style.height=t.videoHeight/3+"px"},e.canvasWrapper.style.display="block",e.recordWrapper.style.display="none",e.shareScreenStream&&$.$emit("isDisplayBtn",{value:!1}),e.addStreamStopListener(r,(function(){if(console.warn("addStreamStopListener addStreamStopListener"),e.recorder)e.recorder.stopRecording(e.stopRecordingCallback);else{let t=[e.shareScreenStream,e.audioStream];t.forEach((function(e){e.getTracks().forEach((function(e){e.stop()}))})),e.shareScreenStream=null,e.audioStream=null,e.localVideo.srcObject=null,document.getElementById("mask")&&document.getElementById("mask").remove(),e.ctx.clearRect(0,0,e.canvas.width,e.canvas.height),$.$emit("isDisplayBtn",{value:!0})}}))})).catch((function(e){alert(e)})):navigator.mediaDevices.getDisplayMedia(r).then((function(r){console.warn("get stream success"),e.getAudioStream(),e.isOpenShareScreen=!0,e.shareScreenStream=r,e.localVideo.stream=r,e.localVideo.srcObject=r,t.oncanplay=function(){t.play(),t.muted=!0,t.style.width=t.videoWidth/3+"px",t.style.height=t.videoHeight/3+"px",o.style.width=t.videoWidth/3+"px",o.style.height=t.videoHeight/3+"px"},e.shareScreenStream&&$.$emit("isDisplayBtn",{value:!1}),e.canvasWrapper.style.display="block",e.recordWrapper.style.display="none",e.addStreamStopListener(r,(function(){if(e.recorder)e.recorder.stopRecording(e.stopRecordingCallback);else{let t=[e.shareScreenStream,e.audioStream];t.forEach((function(e){e.getTracks().forEach((function(e){e.stop()}))})),e.shareScreenStream=null,e.audioStream=null,e.localVideo.srcObject=null,document.getElementById("mask")&&document.getElementById("mask").remove(),e.ctx.clearRect(0,0,e.canvas.width,e.canvas.height),$.$emit("isDisplayBtn",{value:!0})}}))})).catch((function(e){alert(e)}))},handleMouseMove(e){let t=this,o=t.localVideo,r=this.$refs.shareLocalVideo;document.getElementById("mask")&&document.getElementById("mask").remove(),e=window.event||e;let i=e.clientX-r.offsetLeft,a=e.clientY-r.offsetTop,n=e.clientX-o.getBoundingClientRect().left,s=e.clientY-o.getBoundingClientRect().top;n*=3,s*=3,t.startX=n,t.startY=s;var c=document.createElement("div");return c.id="mask",r.appendChild(c),c.style.cssText="width: 0; height: 0; background: lightblue; opacity: 0.4; position: absolute; z-index:999",o.onmousemove=function(e){e=window.event||e;var t=e.clientX-r.offsetLeft,o=e.clientY-r.offsetTop;c.style.left=(t>i?i:t)+"px",c.style.top=(o>a?a:o)+"px",c.style.width=Math.abs(t-i)+"px",c.style.height=Math.abs(o-a)+"px"},!1},handleMouseUP(e){let t=this,o=t.canvas,r=t.localVideo;r.onmousemove=null;let i=document.getElementById("mask");o.style.width=i.offsetWidth+"px",o.style.height=i.offsetHeight+"px";let a=r.videoWidth*(i.offsetWidth/r.offsetWidth),n=r.videoHeight*(i.offsetHeight/r.offsetHeight);function s(e,t,o,r,i,a,n){o.clearRect(0,0,t.width,t.height),c(e,t,o,r,i,a,n)}function c(e,o,r,i,a,n,s){r.drawImage(e,i,a,n,s,0,0,o.width,o.height),t.timer=requestAnimationFrame((()=>{t.shareScreenStream&&c(e,o,r,i,a,n,s)}))}t.canvasWrapper.style.display="block",t.recordWrapper.style.display="none",r.ontimeupdate=function(){console.warn("draw draw draw draw"),s(r,o,t.ctx,t.startX,t.startY,a,n)}},mixingStream(e,t){if(console.info("mixing audio stream"),!e||!t)return void console.info("invalid parameters to mixStream");let o=this;window.AudioContext=window.AudioContext||window.webkitAudioContext||window.mozAudioContext||window.msAudioContext,window.AudioContext?(o.mixStreamContext&&(o.mixStreamContext.close(),o.mixStreamContext=null),o.mixStreamContext=new window.AudioContext):console.error("not support web audio api");let r=o.mixStreamContext.createMediaStreamDestination();if(e){let t=o.mixStreamContext.createMediaStreamSource(e);t.connect(r)}if(t){let e=o.mixStreamContext.createMediaStreamSource(t);e.connect(r)}return r.stream},startRecording(){let e=this;if(e.shareScreenStream&&document.getElementById("mask"))if("Stop Recording"!==e.recordingBtn.value){e.canvasWrapper.style.display="none",e.recordWrapper.style.display="block",e.$refs.downLoadBtn.style.display="none";let t=e.canvas.captureStream(60),o=document.getElementById("mask");if(e.recordVideo.style.width=o.offsetWidth+"px",e.recordVideo.style.height=o.offsetHeight+"px",e.recordVideo.srcObject=t,e.recordVideo.play(),e.recordVideo.muted=!0,e.audioStream.getAudioTracks().length>0)if(e.shareScreenStream&&e.shareScreenStream.getAudioTracks().length>0){let o=e.mixingStream(e.shareScreenStream,e.audioStream),r=o.getAudioTracks()[0];t.addTrack(r)}else t.addTrack(e.audioStream.getAudioTracks()[0]);e.recorder=D()(t,{type:"video"}),e.recorder.startRecording(),$.$emit("recordingValue",{isRecording:!1,value:"Stop Recording"})}else e.stopRecording();else alert("当前没有获取流，请检查； 或者没有选取区域")},stopRecordingCallback(){this.$refs.downLoadBtn.style.display="block",this.recordVideo.src=null,this.recordVideo.srcObject=null,this.file=this.recorder.getBlob(),console.warn("file:",this.file),this.url=URL.createObjectURL(this.file),this.recordVideo.src=this.url,this.recordVideo.play(),this.recordVideo.controls=!0,this.recordVideo.muted=!1,this.localVideo.srcObject=this.localVideo.src=null,this.timer&&(console.warn("this.timer this.timer this.timer this.timer this.timer"),window.cancelAnimationFrame(this.timer)),document.getElementById("mask").remove(),this.localVideo.onmousermove=null,this.localVideo.onmouserup=null,this.localVideo.onmouserup=null,this.localVideo.ontimeupdate=null,this.localVideo.src=this.localVideo.srcObject=null,this.startX=this.startY=null,this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height);let e=[this.shareScreenStream,this.audioStream];e.forEach((function(e){e.getTracks().forEach((function(e){e.stop()}))})),this.shareScreenStream=null,this.recorder.destroy(),this.recorder=null,$.$emit("recordingValue",{isRecording:!1,value:"Start Recording"}),$.$emit("isDisplayBtn",{value:!0})},stopRecording(){let e=this;e.recorder.stopRecording(e.stopRecordingCallback)},addStreamStopListener(e,t){e.addEventListener("ended",(function(){t(),t=function(){}}),!1),e.addEventListener("inactive",(function(){t(),t=function(){}}),!1),e.getTracks().forEach((function(e){e.addEventListener("ended",(function(){t(),t=function(){}}),!1),e.addEventListener("inactive",(function(){t(),t=function(){}}),!1)}))},downLoad(){let e=new Date(parseInt((new Date).getTime()));e=T(e);let t=document.createElement("a");t.target="_blank",t.style.display="none",console.warn("this.url:",this.url),t.href=this.url,t.download="recorded- "+e+".mp4",document.body.appendChild(t),t.click()},openNewTab(){let e=new Date(parseInt((new Date).getTime()));e=T(e);let t="recorder_"+e+".webm",o=new File([this.file],t,{type:"video/webm"});window.open(URL.createObjectURL(o))},streamMuteSwitch(e){if(e&&e.stream&&"audio"===e.type&&e.stream.getAudioTracks().length>0)for(let t=0;t<e.stream.getAudioTracks().length;t++)console.warn("data.mute:",e.mute),e.mute?!0===e.stream.getAudioTracks()[t].enabled&&(console.info("MuteStream exec mute audio"),e.stream.getAudioTracks()[t].enabled=!1,this.isMute=!0):!1===e.stream.getAudioTracks()[t].enabled&&(console.info("MuteStream exec unmute audio"),e.stream.getAudioTracks()[t].enabled=!0,this.isMute=!1)}},beforeDestroy(){$.$off("startRecordingScreen"),$.$off("shareScreen"),$.$off("isMute"),this.mixStreamContext&&(this.mixStreamContext.close(),this.mixStreamContext=null)}},U=I,W=(0,c.Z)(U,E,V,!1,null,"d215185e",null),F=W.exports,N=function(){var e=this,t=e._self._c;return t("div",{staticClass:"recordMutistream"},[t("div",{staticClass:"recordContainer"},[t("h1",{ref:"text"},[e._v("Simple Gif Recording using RecordRTC")]),t("div",{ref:"downLoadBtn",staticClass:"downLoadBtn",staticStyle:{"text-align":"center",display:"none"}},[t("button",{staticClass:"save-to-disk",on:{click:e.downLoad}},[e._v("Save To Disk")]),t("button",{staticClass:"open-new-tab",on:{click:e.startNewTab}},[e._v("Open New Tab")])]),t("div",{staticClass:"mutistreamContent"},[t("img",{ref:"img",staticClass:"mutistreamVideo",staticStyle:{transform:"scale(1)"},attrs:{width:"320"}})])])])},j=[],P={name:"GifRecord.vue",mounted(){this.text=this.$refs.text,this.image=this.$refs.img,$.$on("gifRecording",(e=>{this.button=e.element,this.button.value=e.value,this.startRecording()}))},methods:{startRecording(){let e=this;if("Stop Recording"===e.button.value)return e.button.disabled=!0,e.button.disableStateWaiting=!0,setTimeout((function(){e.button.disabled=!1,e.button.disableStateWaiting=!1}),2e3),void e.recorder.stopRecording(e.stopRecordingCallback);e.$refs.downLoadBtn.style.display="none",e.captureCamera((function(t){$.$emit("gifRecordingValue",{isRecording:!0,value:"Stop Recording"}),e.text.innerHTML="Waiting for Gif Recorder to start...",e.recorder=D()(t,{type:"gif",frameRate:10,quality:1,width:360,hidden:240,onGifRecordingStarted:function(){e.text.innerHTML="Gif recording started."},onGifPreview:function(t){e.image.src=t}}),e.recorder.startRecording(),e.recorder.camera=t}))},captureCamera(e){navigator.mediaDevices.getUserMedia({video:!0}).then((function(t){e(t)})).catch((function(e){alert("Unable to capture your camera. Please check console logs."),console.error(e)}))},stopRecording(){let e=this;e.stopRecording(e.stopRecordingCallback)},stopRecordingCallback(){let e=this;e.text.innerHTML="Gif recording stopped: "+e.bytesToSize(e.recorder.getBlob().size),e.file=e.recorder.getBlob(),e.url=URL.createObjectURL(e.file),e.image.src=e.url,e.recorder.camera.stop(),e.recorder.destroy(),e.recorder=null,$.$emit("gifRecordingValue",{isRecording:!0,value:"Start Recording"}),e.$refs.downLoadBtn.style.display="block"},bytesToSize(e){var t=1e3,o=["Bytes","KB","MB","GB","TB"];if(0===e)return"0 Bytes";var r=parseInt(Math.floor(Math.log(e)/Math.log(t)),10);return(e/Math.pow(t,r)).toPrecision(3)+" "+o[r]},downLoad(){let e;e={type:"video/webm"};let t=new Date(parseInt((new Date).getTime()));t=T(t);let o=document.createElement("a");o.target="_blank",o.style.display="none",o.href=this.url,o.download="record- "+t+".gif",document.body.appendChild(o),o.click()},startNewTab(){window.open(this.url)}},beforeDestroy(){$.$off("gifRecording")}},H=P,G=(0,c.Z)(H,N,j,!1,null,"01001e39",null),Z=G.exports,Y=function(){var e=this,t=e._self._c;return t("div",{staticClass:"recordMutistream"},[t("div",{staticClass:"recordContainer"},[t("div",{ref:"downLoadBtn",staticClass:"downLoadBtn",staticStyle:{"text-align":"center",display:"none"}},[t("button",{staticClass:"save-to-disk",on:{click:e.downLoad}},[e._v("Save To Disk")]),t("button",{staticClass:"open-new-tab",on:{click:e.startNewTab}},[e._v("Open New Tab")])]),t("h2",{ref:"H2",staticStyle:{display:"block"}}),t("div",{staticClass:"mutistreamContent"},[t("audio",{ref:"mutistreamAudio",staticClass:"mutistreamVideo",staticStyle:{transform:"scale(1)"},attrs:{width:"720"}})])])])},q=[];function z(){var e=this,t=function(){};function o(o,i,a){o=o||function(){};var n=document.createElement("input");n.type="file",i&&(n.multiple=!0),a&&(n.webkitdirectory=!0),n.accept=e.accept,n.onclick=function(){n.clickStarted=!0},document.body.onfocus=function(){setTimeout((function(){n.clickStarted&&(n.clickStarted=!1,n.value||t())}),500)},n.onchange=function(){if(i){if(!n.files.length)return void console.error("No file selected.");var e=[];return Array.from(n.files).forEach((function(t){t.url=t.webkitRelativePath,e.push(t)})),void o(e)}n.files[0]?(o(n.files[0]),n.parentNode.removeChild(n)):console.error("No file selected.")},n.style.display="none",(document.body||document.documentElement).appendChild(n),r(n)}function r(e){if("function"!==typeof e.click)if("function"!==typeof e.change){if("undefined"!==typeof document.createEvent("Event")){var t=document.createEvent("Event");if("function"===typeof t.initEvent&&"function"===typeof e.dispatchEvent)return t.initEvent("click",!0,!0),void e.dispatchEvent(t)}t=new MouseEvent("click",{view:window,bubbles:!0,cancelable:!0});e.dispatchEvent(t)}else e.change();else e.click()}e.selectSingleFile=function(e,r){r&&(t=r),o(e)},e.selectMultipleFiles=function(e,r){r&&(t=r),o(e,!0)},e.selectDirectory=function(e,r){r&&(t=r),o(e,!0,!0)},e.accept="*.*"}var X=z;o(8675),o(3462),o(7380),o(1118);var J=o(3204),K=o.n(J),Q={name:"MicrophoneAndMp3Record",mounted(){let e=this;e.video=e.$refs.mutistreamAudio,e.h2=e.$refs.H2,e.isMute=e.$store.getters.getMuteState,$.$on("microphoneMp3Recording",(t=>{e.button=t.element,e.button.value=t.value,e.startRecording()})),$.$on("isMute",(t=>{e.isMute=t.value,e.audioStream&&e.streamMuteSwitch({stream:e.audioStream,type:"audio",mute:e.isMute})}))},methods:{startRecording(){let e=this;if("Stop Recording"===e.button.value)return e.button.disabled=!0,e.button.disableStateWaiting=!0,setTimeout((function(){e.button.disabled=!1,e.button.disableStateWaiting=!1}),2e3),void e.recorder.stopRecording(e.stopRecordingCallback);e.$refs.downLoadBtn.style.display="none",e.getMp3Stream((function(t){e.mp3Stream=t;let o={audio:{exact:{deviceId:e.$store.getters.getCurrentAudioSource},noiseSuppression:!0,echoCancellation:!0}};navigator.mediaDevices.getUserMedia(o).then((function(o){e.audioStream=o,e.audioStream&&e.streamMuteSwitch({stream:e.audioStream,type:"audio",mute:e.isMute});let r=new(K())([o,t]);var i=document.createElement("audio");i.controls=!0,i.autoplay=!0,i.srcObject=r.getMixedStream(),e.video.replaceWith(i),e.video=i;var a=3;(function t(){a--,a<0?e.h2.innerHTML="Mixed Microphone+Mp3!":(e.h2.innerHTML="Seconds left: "+a,setTimeout(t,1e3))})(),e.recorder=D()(r.getMixedStream(),{mimeType:"audio/webm",timeSlice:1e3,type:"audio"}),$.$emit("startRecordingMp3",{isRecording:!1,value:"Stop Recording"}),e.recorder.startRecording()}))}))},getMp3Stream(e){var t=new X;t.accept="*.mp3",t.selectSingleFile((function(t){window.AudioContext=window.AudioContext||window.webkitAudioContext;var o=new AudioContext,r=o.createGain();r.connect(o.destination),r.gain.value=0;var i=new FileReader;function a(t){var i=o.createBufferSource();i.buffer=t,i.start(0,0),i.connect(r);var a=o.createMediaStreamDestination();i.connect(a),e(a.stream,1e3*t.duration)}i.onload=function(e){o.decodeAudioData(e.target.result,a)},i.readAsArrayBuffer(t)}),(function(){document.querySelector("#btn-get-mixed-stream").disabled=!1,alert("Please select mp3 file.")}))},streamMuteSwitch(e){if(e&&e.stream&&"audio"===e.type&&e.stream.getAudioTracks().length>0)for(let t=0;t<e.stream.getAudioTracks().length;t++)console.warn("data.mute:",e.mute),e.mute?!0===e.stream.getAudioTracks()[t].enabled&&(console.info("MuteStream exec mute audio"),e.stream.getAudioTracks()[t].enabled=!1,this.isMute=!0):!1===e.stream.getAudioTracks()[t].enabled&&(console.info("MuteStream exec unmute audio"),e.stream.getAudioTracks()[t].enabled=!0,this.isMute=!1)},stopRecordingCallback(){let e=this;e.file=e.recorder.getBlob(),e.video.srcObject=null,e.url=URL.createObjectURL(e.file),e.video.src=e.url,e.video.muted=!1,e.video.play(),e.video.controls=!0,e.recorder.destroy(),e.recorder=null,e.button.value="Start Recording",$.$emit("startRecordingMp3",{isRecording:!0,value:"Start Recording"}),e.$refs.downLoadBtn.style.display="block";let t=[e.mp3Stream,e.audioStream];t.forEach((function(e){e.getTracks().forEach((function(e){e.stop()}))})),e.mp3Stream=e.audioStream=null},downLoad(){let e;e={type:"video/webm"};let t=new Date(parseInt((new Date).getTime()));t=T(t);let o=document.createElement("a");o.target="_blank",o.style.display="none",o.href=this.url,o.download="record- "+t+".mp4",document.body.appendChild(o),o.click()},startNewTab(){let e=new Date(parseInt((new Date).getTime()));e=T(e);let t="recorder_"+e+".webm",o=new File([this.file],t,{type:"video/webm"});window.open(URL.createObjectURL(o))}},beforeDestroy(){$.$off("microphoneMp3Recording"),$.$off("isMute")}},ee=Q,te=(0,c.Z)(ee,Y,q,!1,null,"a95f0938",null),oe=te.exports,re={name:"AdvanceRecord",data(){return{currentRecordType:""}},props:["advancedRecordingMedia"],components:{MicrophoneMp3:oe,GifRecord:Z,RegionalStream:F,MutiStream:_},mounted(){this.currentRecordType="advanced-Recorded"===this.$store.state.currentRecordMethod?this.advancedRecordingMedia[0].value:null,this.startRecordingBtn=this.$refs.startBtn,this.shareScreenBtn=this.$refs.shareScreenBtn,$.$on("startRecordingValue",(e=>{console.warn("data:",e),this.startRecordingBtn.innerHTML=e.value})),$.$on("recordingValue",(e=>{this.startRecordingBtn.innerHTML=e.value})),$.$on("gifRecordingValue",(e=>{this.startRecordingBtn.innerHTML=e.value})),$.$on("startRecordingMp3",(e=>{this.startRecordingBtn.innerHTML=e.value})),$.$on("isDisplayBtn",(e=>{e.value?this.shareScreenBtn.style.display="block":this.shareScreenBtn.style.display="none"}))},methods:{getAdavncedRecordMedia(){this.currentRecordType="advanced-Recorded"===this.$store.state.currentRecordMethod?this.$refs.advancedRecordMedia.value:null},handleRecord(){"record-regionalScreen"===this.currentRecordType?$.$emit("startRecordingScreen",{isRecording:!0,element:this.startRecordingBtn,value:this.startRecordingBtn.innerHTML}):"record-camera-plus-screen"===this.currentRecordType?$.$emit("startRecording",{isRecording:!0,element:this.startRecordingBtn,value:this.startRecordingBtn.innerHTML}):"gif-record"===this.currentRecordType?$.$emit("gifRecording",{isRecording:!0,element:this.startRecordingBtn,value:this.startRecordingBtn.innerHTML}):"microphone-mp3"===this.currentRecordType&&$.$emit("microphoneMp3Recording",{isRecording:!0,element:this.startRecordingBtn,value:this.startRecordingBtn.innerHTML})},handleShareStream(){$.$emit("shareScreen",{isShare:!0,element:this.shareScreenBtn,value:this.shareScreenBtn.innerHTML})}},beforeDestroy(){$.$off("startRecordingValue"),$.$off("recordingValue"),$.$off("isDisplayBtn"),$.$off("shareScreen"),$.$off("startRecording")}},ie=re,ae=(0,c.Z)(ie,b,R,!1,null,"565d1bfd",null),ne=ae.exports,se=function(){var e=this,t=e._self._c;return t("div",{staticClass:"recordWrapper"},[t("div",{staticClass:"recordBttonWrapper"},[t("div",{staticClass:"recordBtton"},[t("div",[t("select",{ref:"normalRecordMedia",staticClass:"recording-media",on:{change:e.getNormalRecordMedia}},e._l(e.normalRecordingMedia,(function(o,r){return t("option",{key:r,domProps:{value:o.value}},[e._v(e._s(o.text))])})),0)]),t("div",[t("select",{ref:"normalMediaResolutions",staticClass:"media-resolutions",on:{change:e.getNormalMediaResolution}},e._l(e.mediaResolutions,(function(o,r){return t("option",{key:r,domProps:{value:o.value}},[e._v(e._s(o.text))])})),0)]),t("div",[t("select",{ref:"normalMediaFramerates",staticClass:"media-framerates",on:{change:e.getNormalMediaFramerates}},e._l(e.mediaFramerates,(function(o,r){return t("option",{key:r,domProps:{value:o.value}},[e._v(e._s(o.text))])})),0)]),t("div",{staticClass:"recordBtn"},[t("button",{ref:"startBtn",staticClass:"startBtn",on:{click:e.handleRecord}},[e._v(" Start Recording")])])])]),t("div",{staticClass:"recordContent"},[t("div",{ref:"recordingPlayer",attrs:{id:"recording-player"}},[t("div",{ref:"downLoadBtn",staticStyle:{"text-align":"center",display:"none",height:"50px"}},[t("button",{staticClass:"save-to-disk",on:{click:e.downLoad}},[e._v("Save To Disk")]),t("button",{staticClass:"open-new-tab",on:{click:e.startNewTab}},[e._v("Open New Tab")])]),t("div",{ref:"videoContent",staticClass:"shareScreenContent"},[t("video",{ref:"recorderVideo",staticClass:"shareScreenVideo",staticStyle:{transform:"scale(1)",width:"100%"}})])])])])},ce=[],de={name:"AbnormalRecord",data(){return{mediaResolutions:[{index:0,text:"Default resolutions",value:"Default"},{index:1,text:"1080p",value:"1920x1080"},{index:2,text:"720p",value:"1280x720"},{index:3,text:"480p",value:"640x480"},{index:4,text:"360p",value:"640x360"}],mediaFramerates:[{index:0,text:"Default framerates",value:"default"},{index:1,text:"5 fps",value:"5"},{index:2,text:"15 fps",value:"15"},{index:3,text:"24 fps",value:"24"},{index:4,text:"30 fps",value:"30"}],currentRecordType:"",currentResolutions:"",currentFramerates:""}},props:["normalRecordingMedia"],mounted(){this.$nextTick((function(){this.video=this.$refs.recorderVideo,this.audio=this.$refs.recorderAudio,this.currentRecordType="normal-Recorded"===this.$store.state.currentRecordMethod?this.normalRecordingMedia[0].value:this.advancedRecordingMedia[0].value,this.currentResolutions=this.mediaResolutions[0].value,this.currentFramerates=this.mediaFramerates[0].value}))},methods:{init(){let e=this;if("record-audio"===e.currentRecordType?e.type="audio/webm":e.type="video/webm",e.button=this.$refs.startBtn,"Stop Recording"===e.button.innerHTML)return e.button.disabled=!0,e.button.disableStateWaiting=!0,setTimeout((function(){e.button.disabled=!1,e.button.disableStateWaiting=!1}),2e3),e.button.innerHTML="Start Recording",void e.recorder.stopRecording(e.stopRecordingCallback);if(!event)return;e.button.disabled=!0,e.$refs.downLoadBtn.style.display="none",e.button.mediaCapturedCallback=function(){console.warn(" button.mediaCapturedCallback  button.mediaCapturedCallback  button.mediaCapturedCallback ");let t={mimeType:e.type,timeSlice:1e3,type:"video"};e.recorder=D()(e.button.stream,t),e.recorder.startRecording()};let t={onMediaCaptured:function(t){if(e.button.stream=t,window.stream=t,e.video.src=e.video.srcObject=null,"record-audio"===e.currentRecordType){var o=document.createElement("audio");o.controls=!0,o.autoplay=!0,o.srcObject=t,e.video.replaceWith(o),e.video=o}else{let{width:o,height:r}=t.getVideoTracks()[0].getConstraints();console.warn("getContraints :",o,r),e.video.srcObject=t,e.video.muted=!0,e.video.oncanplay=function(){e.video.play()},e.video.onloadedmetadata=async function(){await e.video.play(),e.video.muted=!0,o&&(o.max>1280||o.exact>1280)?(e.video.style.width=o&&(o.max||o.exact)/3+"px",e.video.style.height=r&&(r.max||r.exact)/3+"px"):!o||1280!==o.max&&1280!==o.exact?!o||640!==o.max&&640!==o.exact?(e.video.style.width="640px",e.video.style.height="360px"):(e.video.style.width=(o.max||o.exact)+"px",e.video.style.height=(r.max||r.exact)+"px"):(e.video.style.width=o&&(o.max||o.exact)/2+"px",e.video.style.height=r&&(r.max||r.exact)/2+"px")}}e.button.mediaCapturedCallback&&e.button.mediaCapturedCallback(),e.button.innerHTML="Stop Recording",e.button.disabled=!1},onMediaStopped:function(){console.warn("stop stop stream"),e.button.innerHTML="Start Recording",e.button.disableStateWaiting||(e.button.disabled=!1),e.button.stream&&e.recorder.stopRecording(e.stopRecordingCallback)},onMediaCapturingFailed:function(e){console.error("onMediaCapturingFailed:",e),alert("onMediaCapturingFailed:",e),-1!==e.toString().indexOf("no audio or video tracks available")&&alert("RecordRTC failed to start because there are no audio or video tracks available."),t.onMediaStopped()}};if("record-audio-plus-video"===e.currentRecordType){function o(t){e.captureUserMedia({video:!0,audio:!0},(function(o){t.onMediaCaptured(o),o instanceof Array?o.forEach((function(o){e.addStreamStopListener(o,(function(){t.onMediaStopped()}))})):e.addStreamStopListener(o,(function(){t.onMediaStopped()}))}),(function(e){t.onMediaCapturingFailed(e)}))}o(t)}else if("record-audio"===e.currentRecordType){function r(t){e.captureUserMedia({audio:!0},(function(o){t.onMediaCaptured(o),e.addStreamStopListener(o,(function(){t.onMediaStopped()}))}),(function(e){t.onMediaCapturingFailed(e)}))}r(t)}else if("record-screen"===e.currentRecordType){function i(t){if(navigator.getDisplayMedia)navigator.getDisplayMedia({audio:!0,video:{width:{max:1920},height:{max:1080},frameRate:{max:15}}}).then((o=>{t.onMediaCaptured(o),e.addStreamStopListener(o,(function(){t.onMediaStopped()})),setVideoURL(o,!0)})).catch((function(e){t.onMediaCapturingFailed(e)}));else if(navigator.mediaDevices.getDisplayMedia)navigator.mediaDevices.getDisplayMedia({audio:!0,video:{width:{max:1920},height:{max:1080},frameRate:{max:15}}}).then((o=>{t.onMediaCaptured(o),e.addStreamStopListener(o,(function(){t.onMediaStopped()}))})).catch((function(e){t.onMediaCapturingFailed(e)}));else{var o="getDisplayMedia API are not supported in this browser.";t.onMediaCapturingFailed(o),alert(o)}}i(t)}else if("record-audio-plus-screen"===e.currentRecordType){function a(t){if(navigator.getDisplayMedia)navigator.getDisplayMedia({audio:!0,video:{width:{max:1920},height:{max:1080},frameRate:{max:15}}}).then((o=>{e.captureUserMedia({audio:!0},(function(r){let i;e.audio=r;let a=[];if(o.getAudioTracks().length>0){let t=e.mixingStream(o,e.audio).getAudioTracks()[0];a.push(t),a.push(o.getVideoTracks()[0]),i=new MediaStream(a)}else a.push(e.audio.getAudioTracks()[0]),a.push(o.getVideoTracks()[0]),i=new MediaStream(a);t.onMediaCaptured(i),e.addStreamStopListener(o,(function(){t.onMediaStopped()}))}),(function(e){console.warn("音频取流失败：",e),alert("音频取流失败：",e)}))})).catch((function(e){t.onMediaCapturingFailed(e)}));else if(navigator.mediaDevices.getDisplayMedia)navigator.mediaDevices.getDisplayMedia({audio:!0,video:{width:{max:1920},height:{max:1080},frameRate:{max:15}}}).then((o=>{e.captureUserMedia({audio:!0},(function(r){let i;e.audio=r;let a=[];if(o.getAudioTracks().length>0){let t=e.mixingStream(o,e.audio).getAudioTracks()[0];a.push(t),a.push(o.getVideoTracks()[0]),i=new MediaStream(a)}else a.push(e.audio.getAudioTracks()[0]),a.push(o.getVideoTracks()[0]),i=new MediaStream(a);t.onMediaCaptured(i),e.addStreamStopListener(o,(function(){t.onMediaStopped()}))}),(function(e){console.warn("音频取流失败：",e),alert("音频取流失败：",e)}))})).catch((function(e){t.onMediaCapturingFailed(e)}));else{var o="getDisplayMedia API are not supported in this browser.";t.onMediaCapturingFailed(o),alert(o)}}a(t)}},getNormalRecordMedia(){this.currentRecordType="normal-Recorded"===this.$store.state.currentRecordMethod?this.$refs.normalRecordMedia.value:null},getNormalMediaResolution(){this.currentResolutions="normal-Recorded"===this.$store.state.currentRecordMethod?this.$refs.normalMediaResolutions.value:null},getNormalMediaFramerates(){this.currentFramerates="normal-Recorded"===this.$store.state.currentRecordMethod?this.$refs.normalMediaFramerates.value:null},handleRecord(){this.init()},captureUserMedia(e,t,o){e=this.getVideoResolutions(e),e=this.getFrameRates(e),console.warn("mediaConstraints:",e),navigator.mediaDevices.getUserMedia(e).then((function(e){t(e)})).catch((function(e){!e||"ConstraintNotSatisfiedError"!==e.name&&"OverconstrainedError"!==e.name?e&&e.message?alert(e.message):alert("Unable to make getUserMedia request. Please check browser console logs."):alert('Your camera or browser does NOT supports selected resolutions or frame-rates. \n\nPlease select "default" resolutions.'),o(e)}))},addStreamStopListener(e,t){e.addEventListener("ended",(function(){t(),t=function(){}}),!1),e.addEventListener("inactive",(function(){t(),t=function(){}}),!1),e.getTracks().forEach((function(e){e.addEventListener("ended",(function(){t(),t=function(){}}),!1),e.addEventListener("inactive",(function(){t(),t=function(){}}),!1)}))},getVideoResolutions(e){let t,o;if(1==e.video&&(e.video={}),1==e.audio&&(e.audio={}),!e.audio.deviceId){e.audio.deviceId={};let t=this.$store.getters.getCurrentAudioSource;e.audio.deviceId={exact:t}}if(!e.video)return e;let r=this.$store.getters.getCurrentVideoSource;e.video.deviceId={exact:r};let i=this.currentResolutions;if("Default"==i||"default"==i)return e;i=i.split("x"),t=parseInt(i[0]),o=parseInt(i[1]),e.video.width&&e.video.height||(e.video.width={},e.video.height={});var a=-1!=this.currentRecordType.toString().toLowerCase().indexOf("screen");return a?(e.video.width={max:t},e.video.height={max:o}):(e.video.width={exact:t},e.video.height={exact:o}),console.warn(" mediaConstraints:",e),e},getFrameRates(e){if(!e.video)return e;let t=this.currentFramerates;if("default"==t)return e;t=parseInt(t),e.video.width&&e.video.height||(e.video.width={},e.video.height={});var o=-1!=this.currentRecordType.toString().toLowerCase().indexOf("screen");return e.video.frameRate=o?{max:t}:{exact:t},e},stopRecordingCallback(){let e=this;e.$refs.downLoadBtn.style.display="block",e.file=e.recorder.getBlob(),e.url=URL.createObjectURL(e.file),e.video.src=e.video.srcObject=null,e.video.src=e.url,e.video.muted=!1,e.video.controls=!0,e.video.play(),e.recorder.destroy(),e.recorder=null;let t=[e.button.stream];e.audio&&t.push(e.audio),t.forEach((function(e){e.getTracks().forEach((function(e){e.stop()}))})),e.button.stream=null},mixingStream(e,t){if(console.info("mixing audio stream"),!e||!t)return void console.info("invalid parameters to mixStream");let o=this;window.AudioContext=window.AudioContext||window.webkitAudioContext||window.mozAudioContext||window.msAudioContext,window.AudioContext?(o.mixStreamContext&&(o.mixStreamContext.close(),o.mixStreamContext=null),o.mixStreamContext=new window.AudioContext):console.error("not support web audio api");let r=o.mixStreamContext.createMediaStreamDestination();if(e){let t=o.mixStreamContext.createMediaStreamSource(e);t.connect(r)}if(t){let e=o.mixStreamContext.createMediaStreamSource(t);e.connect(r)}return r.stream},closeStream(e){if(e){console.info("close stream id: "+e.id);try{e.oninactive=null;let t=e.getTracks();for(let e in t)t[e].onended=null,console.info("close stream"),t[e].stop()}catch(t){console.info("closeStream: Failed to close stream"),console.info(t)}}else console.info("closeStream:stream is null")},downLoad(){let e=new Date(parseInt((new Date).getTime()));e=T(e);let t=document.createElement("a");t.target="_blank",t.style.display="none",t.href=this.url,t.download="record - "+e+".mp4",document.body.appendChild(t),t.click()},startNewTab(){let e=new Date(parseInt((new Date).getTime()));e=T(e);let t="recorder_"+e+".webm",o=new File([this.file],t,{type:this.type});window.open(URL.createObjectURL(o))}},beforeDestroy(){this.mixStreamContext&&(this.mixStreamContext.close(),this.mixStreamContext=null)}},le=de,ue=(0,c.Z)(le,se,ce,!1,null,"1211588b",null),me=ue.exports,he=o(629),pe={name:"Record",components:{NormalRecord:me,AdvanceRecord:ne},data(){return{normalRecordingMedia:[{index:0,text:"Microphone+Camera",value:"record-audio-plus-video"},{index:1,text:"Microphone",value:"record-audio"},{index:2,text:"Full Screen",value:"record-screen"},{index:3,text:"Microphone+Screen",value:"record-audio-plus-screen"}],advancedRecordingMedia:[{index:0,text:"Screen+Camera",value:"record-camera-plus-screen"},{index:1,text:"Regional Screen",value:"record-regionalScreen"},{index:2,text:"gif-record",value:"gif-record"},{index:3,text:"microphone-mp3",value:"microphone-mp3"}],currentRecordType:""}},created(){},computed:{...(0,he.rn)(["currentRecordMethod"])}},ve=pe,fe=(0,c.Z)(ve,w,M,!1,null,"7aae6fd3",null),ge=fe.exports,Se={name:"HomePage",components:{Aside:y,Record:ge}},ye=Se,we=(0,c.Z)(ye,m,h,!1,null,"6dcaecc6",null),Me=we.exports;r["default"].use(u.Z);const be=[{path:"/",name:"mainView",component:Me}],Re=new u.Z({routes:be});var xe=Re,Ce={shareScreen:!0,shareType:"",slidesStream:"",audioStream:"",mainStream:"",setMuteState:!1,currentAudioSource:"",currentAudioutput:"",currentVideoSource:"",currentRecordMethod:""},ke={getShareScreen:e=>e.shareScreen,getShareType:e=>e.shareType,getSlidesStream:e=>e.slidesStream,getMainStream:e=>e.mainStream,getAudioStream:e=>e.audioStream,getRecordStream:e=>e.slidesStream,getCurrentAudioSource:e=>e.currentAudioSource,getCurrentAudioutput:e=>e.currentAudioutput,getCurrentVideoSource:e=>e.currentVideoSource,getCurrentRecordMethod:e=>e.currentRecordMethod,getMuteState:e=>e.setMuteState},Te={async modifyShareScreen(e){await e.commit("setShareScreen",{content:"false"})},async modifySlidesStream(e){await e.commit("setSlidesStream",{content:null})},async modifyShareType(e){await e.commit("setShareType",{content:null})},async modifyAudioSource(e,t){await e.commit("setCurrentAudioSource",{content:t.content})},async modifyAudioOutput(e,t){await e.commit("setCurrentAudioOutput",{content:t.content})},async modifyVideoSource(e,t){await e.commit("setCurrentVideoSource",{content:t.content})},async modifyRecordMethod(e,t){await e.commit("setCurrentRecordMethod",{content:t.content})},async modifyMuteState(e,t){await e.commit("setMuteState",{context:t.content}),$.$emit("isMute",{value:t.content})}},Ae={setShareType:(e,t)=>{e.shareType=t.content},setShareScreen:(e,t)=>{e.shareScreen=t.content},setSlidesStream:(e,t)=>{e.slidesStream=t.content},setMainStream:(e,t)=>{e.mainStream=t.content},setAudioStream:(e,t)=>{e.audioStream=t.content,console.warn("state：",e)},setRecordStream:(e,t)=>{e.recordStream=t.content},setCurrentAudioSource:(e,t)=>{e.currentAudioSource=t.content},setCurrentAudioOutput:(e,t)=>{e.currentAudioutput=t.content},setCurrentVideoSource:(e,t)=>{e.currentVideoSource=t.content},setCurrentRecordMethod:(e,t)=>{e.currentRecordMethod=t.content},setMuteState:(e,t)=>{e.setMuteState=t.content}};r["default"].use(he.ZP);var De=new he.ZP.Store({state:Ce,getters:ke,mutations:Ae,actions:Te,modules:{}}),$e=o(4720),Oe=o.n($e);const Le={methods:{getUserMedia(e){window.content=e,console.warn("content:",e.event);let t,o,r=this;function i(e,t){function o(o){console.info("get stream success constraints: "+JSON.stringify(t,null,"  ")),e.callback({stream:o||e.stream})}function r(o){e.error=o,console.warn("get stream failed: "+JSON.stringify(t,null,"  ")),console.warn("onGetStreamFailed error message: "+o.message),console.warn("error name: "+o.name),console.warn("error constraint: "+o.constraints),"OverconstrainedError"===o.name||"ConstraintNotSatisfiedError"===o.name||"Error"===o.name?(console.info("constraints can not be satisfied by avb.device"),e.callback({error:o,constraints:t})):("NotFoundError"===o.name||"DeviceNotFoundError"===o.name?console.info("require track is missing"):"NotReadableError"===o.name||"TrackStartError"===o.name?console.info("webcam or mic are already in use"):"NotAllowedError"===o.name||"PermissionDeniedError"===o.name||"PermissionDismissedError"===o.name?console.info("permission denied in browser"):"TypeError"===o.name?console.info("empty constraints object"):console.info("other errors "+o.name),e.callback({error:o}))}if(console.warn("getMedia"),"audio"===e.streamType)navigator.mediaDevices.getUserMedia(t).then(o).catch(r);else if("video"===e.streamType)if(!e.isFirefox&&e.stream&&e.stream.getVideoTracks().length&&e.stream.active){let o,i={width:{exact:t.video.width.exact},height:{exact:t.video.height.exact}};o=e.stream.getVideoTracks()[0],o&&o.applyConstraints&&(console.info("applyConstraints constraints: "+JSON.stringify(i,null,"    ")),o.applyConstraints(i).then((function(){console.info("video applyConstraints success!"),e.callback({stream:e.stream})})).catch(r))}else navigator.mediaDevices.getUserMedia(t).then(o).catch(r);else"screenShare"===e.streamType&&(window.ipcRenderer?(console.info("ipcRenderer getUserMedia for screen"),navigator.mediaDevices.getUserMedia(t).then(o).catch(r)):navigator.getDisplayMedia?navigator.getDisplayMedia(t).then(o).catch(r):navigator.mediaDevices.getDisplayMedia?navigator.mediaDevices.getDisplayMedia(t).then(o).catch(r):navigator.mediaDevices.getUserMedia?navigator.mediaDevices.getUserMedia(t).then(o).catch(r):console.info("getDisplayMedia is not supported by current browser"))}"标准"===e.event.target.innerText?r.$store.commit({type:"setShareType",content:"标准"}):"高级"===e.event.target.innerText&&r.$store.commit({type:"setShareType",content:"高级"}),"screenShare"===e.type&&(t={audio:!0,video:{width:{max:1920},height:{max:1080},frameRate:{max:15}}},o={streamType:e.type,callback:function(e){if(e.stream){let t=e.stream;r.$store.commit({type:"setSlidesStream",content:t}),r.$store.dispatch("modifyShareScreen")}else console.warn("error:",e.error)}}),i(o,t)},closeStream(e){if(e){log.info("close stream id: "+e.id);try{e.oninactive=null;let t=e.getTracks();for(let e in t)t[e].onended=null,log.info("close stream"),t[e].stop()}catch(t){log.info("closeStream: Failed to close stream"),log.info(t)}e=null}else log.info("closeStream:stream is null")},streamMuteSwitch(e){if(e&&e.stream&&"audio"===e.type&&e.stream.getAudioTracks().length>0)for(let t=0;t<e.stream.getAudioTracks().length;t++)console.warn("data.mute:",e.mute),e.mute?!0===e.stream.getAudioTracks()[t].enabled&&(console.info("MuteStream exec mute audio"),e.stream.getAudioTracks()[t].enabled=!1,this.isMute=!0):!1===e.stream.getAudioTracks()[t].enabled&&(console.info("MuteStream exec unmute audio"),e.stream.getAudioTracks()[t].enabled=!0,this.isMute=!1)}}};r["default"].use(Oe()),r["default"].mixin(Le),r["default"].config.productionTip=!1,new r["default"]({router:xe,store:De,render:e=>e(l)}).$mount("#app")}},t={};function o(r){var i=t[r];if(void 0!==i)return i.exports;var a=t[r]={exports:{}};return e[r](a,a.exports,o),a.exports}o.m=e,function(){var e=[];o.O=function(t,r,i,a){if(!r){var n=1/0;for(l=0;l<e.length;l++){r=e[l][0],i=e[l][1],a=e[l][2];for(var s=!0,c=0;c<r.length;c++)(!1&a||n>=a)&&Object.keys(o.O).every((function(e){return o.O[e](r[c])}))?r.splice(c--,1):(s=!1,a<n&&(n=a));if(s){e.splice(l--,1);var d=i();void 0!==d&&(t=d)}}return t}a=a||0;for(var l=e.length;l>0&&e[l-1][2]>a;l--)e[l]=e[l-1];e[l]=[r,i,a]}}(),function(){o.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return o.d(t,{a:t}),t}}(),function(){o.d=function(e,t){for(var r in t)o.o(t,r)&&!o.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:t[r]})}}(),function(){o.g=function(){if("object"===typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"===typeof window)return window}}()}(),function(){o.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)}}(),function(){o.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})}}(),function(){var e={143:0};o.O.j=function(t){return 0===e[t]};var t=function(t,r){var i,a,n=r[0],s=r[1],c=r[2],d=0;if(n.some((function(t){return 0!==e[t]}))){for(i in s)o.o(s,i)&&(o.m[i]=s[i]);if(c)var l=c(o)}for(t&&t(r);d<n.length;d++)a=n[d],o.o(e,a)&&e[a]&&e[a][0](),e[a]=0;return o.O(l)},r=self["webpackChunkrecord_demo"]=self["webpackChunkrecord_demo"]||[];r.forEach(t.bind(null,0)),r.push=t.bind(null,r.push.bind(r))}();var r=o.O(void 0,[998],(function(){return o(917)}));r=o.O(r)})();
//# sourceMappingURL=app.8942b575.js.map